# 润扬大桥运维文档管理系统 - 配置指南

## 📋 配置概览

本系统提供灵活的配置选项，支持开发、测试和生产环境的不同需求。

### 快速配置检查表

- [ ] **CORS配置** - 跨域请求设置
- [ ] **网络配置** - IP地址和端口设置  
- [ ] **域名配置** - 自定义域名和HTTPS
- [ ] **前端配置** - 构建和部署选项
- [ ] **数据库配置** - 数据存储设置

---

## 🌐 CORS配置

### 开发环境（推荐）
```env
# 在 backend/.env 中配置
CORS_MODE=auto
CORS_AUTO_DETECT=true
CORS_INCLUDE_LOCALHOST=true
CORS_FRONTEND_PORT=5173
```

### 生产环境
```env
# 手动指定允许的域名
CORS_MODE=manual
CORS_CUSTOM_ORIGINS=https://yourdomain.com,https://admin.yourdomain.com
```

### 局域网部署
```env
CORS_MODE=auto
CORS_AUTO_DETECT=true
CORS_INCLUDE_LOCALHOST=true
CORS_EXTRA_PORTS=3000,8080,9000
```

---

## 🔧 网络配置

### 默认端口
- **后端API**: 8002
- **前端开发**: 5173
- **前端生产**: 80/443

### 自定义端口
```env
# backend/app/core/config.py
SERVER_HOST = "0.0.0.0"
SERVER_PORT = 8002

# frontend/vite.config.ts
server: {
  port: 5173,
  host: true
}
```

### 防火墙配置
```bash
# Linux防火墙开放端口
sudo ufw allow 8002
sudo ufw allow 5173

# Windows防火墙
netsh advfirewall firewall add rule name="RunYang System" dir=in action=allow protocol=TCP localport=8002,5173
```

---

## 🌍 域名和HTTPS配置

### 域名绑定
1. **DNS配置**
   ```
   A记录: yourdomain.com -> 服务器IP
   A记录: api.yourdomain.com -> 服务器IP
   ```

2. **Nginx配置示例**
   ```nginx
   # /etc/nginx/sites-available/runyang-system
   server {
       listen 80;
       server_name yourdomain.com;
       
       # 前端静态文件
       location / {
           root /path/to/frontend/dist;
           try_files $uri $uri/ /index.html;
       }
       
       # API代理
       location /api/ {
           proxy_pass http://localhost:8002;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```

3. **HTTPS证书**
   ```bash
   # 使用Let's Encrypt
   sudo certbot --nginx -d yourdomain.com
   ```

### 前端域名配置
```typescript
// frontend/src/services/api.ts
const API_BASE_URL = import.meta.env.PROD 
  ? 'https://api.yourdomain.com'
  : 'http://localhost:8002';
```

---

## 🎨 前端配置

### 开发环境
```typescript
// frontend/vite.config.ts
export default defineConfig({
  server: {
    port: 5173,
    host: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8002',
        changeOrigin: true
      }
    }
  }
})
```

### 生产构建
```bash
# 构建优化
npm run build

# 预览构建结果
npm run preview
```

### 环境变量
```env
# frontend/.env.production
VITE_API_BASE_URL=https://api.yourdomain.com
VITE_APP_TITLE=润扬大桥运维系统
```

---

## 🗄️ 数据库配置

### SQLite配置（默认）
```python
# backend/app/core/config.py
DATABASE_URL = "sqlite:///./backend/yunwei_docs.db"
```

### MySQL配置
```python
DATABASE_URL = "mysql+pymysql://user:password@localhost/runyang_db"
```

### PostgreSQL配置
```python
DATABASE_URL = "postgresql://user:password@localhost/runyang_db"
```

---

## 🚀 性能优化配置

### 后端优化
```python
# backend/app/core/config.py
# 文件上传限制
MAX_FILE_SIZE = 50 * 1024 * 1024  # 50MB

# 数据库连接池
SQLALCHEMY_POOL_SIZE = 10
SQLALCHEMY_MAX_OVERFLOW = 20
```

### 前端优化
```typescript
// frontend/vite.config.ts
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        vendor: ['vue', 'vue-router'],
        ui: ['element-plus']
      }
    }
  }
}
```

---

## ⚡ 常见配置问题

### CORS错误
**现象**: 前端无法访问后端API
**解决**: 检查CORS配置，确保前端地址在允许列表中

### 端口冲突
**现象**: 服务启动失败，提示端口被占用
**解决**: 
```bash
# Windows查看端口占用
netstat -ano | findstr :8002

# Linux查看端口占用
lsof -i :8002
```

### 文件上传失败
**现象**: 大文件上传超时
**解决**: 调整Nginx和后端的上传限制
```nginx
client_max_body_size 100M;
```

---

## 📝 配置文件位置

```
项目根目录/
├── backend/
│   ├── .env                    # 后端环境变量
│   ├── app/core/config.py      # 后端核心配置
│   └── requirements.txt        # Python依赖
├── frontend/
│   ├── .env.production         # 前端生产环境变量
│   ├── vite.config.ts          # 前端构建配置
│   └── package.json           # Node.js依赖
└── docs/                      # 配置文档
```

---

## 🔍 配置验证

使用以下脚本验证配置是否正确：

```bash
# 检查后端配置
curl http://localhost:8002/health

# 检查前端配置
curl http://localhost:5173

# 检查CORS配置
curl -H "Origin: http://localhost:5173" http://localhost:8002/api/v1/auth/me
```

---

## 📞 获取支持

如果配置过程中遇到问题：

1. 查看 `logs/` 目录中的日志文件
2. 参考 `docs/` 目录中的其他文档
3. 检查系统要求和依赖安装
4. 确认防火墙和网络设置

更多详细信息请参考对应的专项配置文档。